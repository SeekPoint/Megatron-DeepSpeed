

(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$ bash pretrain_gpt2.sh
/home/amd00/anaconda3/envs/gh_Megatron-DeepSpeed/lib/python3.10/site-packages/torch/distributed/launch.py:180: FutureWarning: The module torch.distributed.launch is deprecated
and will be removed in future. Use torchrun.
Note that --use_env is set by default in torchrun.
If your script expects `--local_rank` argument to be set, please
change it to read from `os.environ['LOCAL_RANK']` instead. See
https://pytorch.org/docs/stable/distributed.html#launch-utility for
further instructions
.....
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/megatron/utils.py", line 27, in <module>
    from apex.multi_tensor_apply import multi_tensor_applier
  File "/home/amd00/anaconda3/envs/gh_Megatron-DeepSpeed/lib/python3.10/site-packages/apex/__init__.py", line 13, in <module>
    from pyramid.session import UnencryptedCookieSessionFactoryConfig
ImportError: cannot import name 'UnencryptedCookieSessionFactoryConfig' from 'pyramid.session' (unknown location)

解决，安装apex！！！
================================================================
安装apex遇到
no packageing
错误


解决：

可能的版本
git checkout 3303b3e7174383312a3468ef390060c26e640cb1
pip install -v --disable-pip-version-check --no-cache-dir --no-build-isolation --config-settings "--build-option=--cpp_ext" --config-settings "--build-option=--cuda_ext" ./


 pip install -v --disable-pip-version-check --no-cache-dir --global-option="--cpp_ext" --global-option="--cuda_ext" ./


=================================================

apex安装、解决ModuleNotFoundError: No module named ‘amp_C‘报错

把import amp_C 去掉！----只能暂时通过，后续还
=============================================




Traceback (most recent call last):
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/pretrain_gpt.py", line 20, in <module>
    from megatron import get_args
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/megatron/__init__.py", line 28, in <module>
    from .global_vars import get_args
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/megatron/global_vars.py", line 23, in <module>
    from packaging import version
ImportError: cannot import name 'version' from 'packaging' 

----pip install -U packaging


========================================================


https://stackoverflow.com/questions/75751907/oserror-cuda-home-environment-variable-is-not-set-please-set-it-to-your-cuda-i

pip3 install torch==1.13.1+cu117 torchvision==0.14.1+cu117 \
  torchaudio==0.13.1 --extra-index-url https://download.pytorch.org/whl/cu117

Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$ conda install -c "nvidia/label/cuda-11.7" cuda

==============================================



(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$ find /home/amd00/anaconda3/ -name libcudart.so
/home/amd00/anaconda3/pkgs/cudatoolkit-10.2.89-h713d32c_10/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cudatoolkit-10.1.243-h8cb64d8_10/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cuda-cudart-dev-12.1.55-0/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cudatoolkit-10.1.243-h6bb024c_0/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cudatoolkit-10.2.89-hfd86e86_1/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cuda-cudart-dev-11.7.60-h6a7c232_0/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cudatoolkit-11.0.3-h88f8997_10/lib/libcudart.so
/home/amd00/anaconda3/pkgs/cuda-cudart-dev-12.2.53-0/lib/libcudart.so
/home/amd00/anaconda3/envs/ds_chat_py39/lib/libcudart.so
/home/amd00/anaconda3/envs/yk_py38_cu110/pkgs/cuda-toolkit/targets/x86_64-linux/lib/libcudart.so
/home/amd00/anaconda3/envs/yk_py38_cu110/lib/libcudart.so
/home/amd00/anaconda3/envs/ds_py10/lib/libcudart.so
/home/amd00/anaconda3/envs/gh_Megatron-DeepSpeed/lib/libcudart.so
(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$
(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$
(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$
(gh_Megatron-DeepSpeed) amd00@MZ32-00:~/llm_dev/Megatron-DeepSpeed$ sudo ln -s /home/amd00/anaconda3/envs/gh_Megatron-DeepSpeed/lib/libcudart.so /usr/lib/libcudart.so

参考https://askubuntu.com/questions/510176/usr-bin-ld-cannot-find-lcudart
google搜索时记得去掉-号====/usr/bin/ld: cannot find lcudart  不用用 /usr/bin/ld: cannot find -lcudart
不同的项目有不同的路径！！！
====================================================




    model, optimizer, lr_scheduler = setup_model_and_optimizer(model_provider)
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/megatron/training.py", line 409, in setup_model_and_optimizer
    optimizer = get_megatron_optimizer(unwrapped_model)
  File "/home/amd00/llm_dev/Megatron-DeepSpeed/megatron/optimizer/__init__.py", line 77, in get_megatron_optimizer
    optimizer = adam_optimizer(param_groups,
  File "/home/amd00/anaconda3/envs/gh_Megatron-DeepSpeed/lib/python3.10/site-packages/apex/optimizers/fused_adam.py", line 80, in __init__
    raise RuntimeError('apex.optimizers.FusedAdam requires cuda extensions')
RuntimeError: apex.optimizers.FusedAdam requires cuda extensions
-----重新安装apex
